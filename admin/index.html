<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Admin</title>
    <link rel="icon" type="image/png" href="../assets/Nisha-Rastogi-logo.png">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #fafafa;
            --color-surface: #ffffff;
            --color-border: #e5e5e5;
            --color-text: #1a1a1a;
            --color-text-secondary: #666;
            --color-accent: #0066ff;
            --color-accent-hover: #0052cc;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --radius: 12px;
            --shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }

        .admin-header {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: 16px 32px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-header h1 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--color-accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-accent-hover);
        }

        .btn-secondary {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            border-color: var(--color-text);
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .admin-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 32px;
        }

        .section {
            background: var(--color-surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .section-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .section-header:hover {
            background: #fafafa;
        }

        .section-header h2 {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header .badge {
            background: var(--color-bg);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--color-text-secondary);
        }

        .section-toggle {
            font-size: 1.25rem;
            color: var(--color-text-secondary);
            transition: transform 0.2s;
        }

        .section.collapsed .section-toggle {
            transform: rotate(-90deg);
        }

        .section.collapsed .section-content {
            display: none;
        }

        .section-content {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            font-size: 0.8125rem;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--color-text-secondary);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 0.9375rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .subsection {
            background: var(--color-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .subsection-title {
            font-size: 0.8125rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--color-text-secondary);
            margin-bottom: 16px;
        }

        .image-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .image-item {
            display: flex;
            gap: 12px;
            align-items: center;
            background: var(--color-surface);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }

        .image-item input {
            flex: 1;
        }

        .image-item .btn-remove {
            padding: 8px;
            background: none;
            border: none;
            color: var(--color-danger);
            cursor: pointer;
            font-size: 1.25rem;
        }

        .btn-add {
            width: 100%;
            padding: 12px;
            background: none;
            border: 2px dashed var(--color-border);
            border-radius: 8px;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .btn-add:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 16px 24px;
            background: var(--color-text);
            color: white;
            border-radius: 8px;
            font-weight: 500;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background: var(--color-success);
        }

        .preview-link {
            color: var(--color-accent);
            text-decoration: none;
            font-size: 0.875rem;
        }

        .preview-link:hover {
            text-decoration: underline;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--color-text-secondary);
        }

        /* Modal for JSON output */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--color-surface);
            border-radius: var(--radius);
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.125rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-text-secondary);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-body textarea {
            width: 100%;
            height: 400px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.8125rem;
            padding: 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            resize: none;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--color-border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 1px solid var(--color-border);
            padding: 0 32px;
            background: var(--color-surface);
        }

        .nav-tab {
            padding: 16px 20px;
            background: none;
            border: none;
            font-size: 0.9375rem;
            color: var(--color-text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            font-family: inherit;
        }

        .nav-tab:hover {
            color: var(--color-text);
        }

        .nav-tab.active {
            color: var(--color-text);
            border-bottom-color: var(--color-accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <h1>üìù Portfolio Admin</h1>
        <div class="header-actions">
            <a href="../index.html" class="btn btn-secondary" target="_blank">Preview Site ‚Üó</a>
            <button class="btn btn-primary" onclick="saveChanges()">Save Changes</button>
        </div>
    </header>

    <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="profile">Profile</button>
        <button class="nav-tab" data-tab="about">About Page</button>
        <button class="nav-tab" data-tab="projects">Projects</button>
    </nav>

    <main class="admin-container">
        <!-- Profile Tab -->
        <div id="tab-profile" class="tab-content active">
            <div class="section" id="profile-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2>Profile Information</h2>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content" id="profile-form">
                    <!-- Profile form will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- About Page Tab -->
        <div id="tab-about" class="tab-content">
            <div id="about-page-container">
                <!-- About Page form will be populated by JS -->
            </div>
        </div>

        <!-- Projects Tab -->
        <div id="tab-projects" class="tab-content">
            <div id="projects-container">
                <!-- Project sections will be populated by JS -->
            </div>
        </div>
    </main>

    <!-- JSON Output Modal -->
    <div class="modal-overlay" id="json-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Updated JSON</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 12px; color: var(--color-text-secondary); font-size: 0.875rem;">
                    Copy this JSON and paste it into your <code>data/projects.json</code> file:
                </p>
                <textarea id="json-output" readonly></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                <button class="btn btn-primary" onclick="copyToClipboard()">Copy to Clipboard</button>
                <button class="btn btn-success" onclick="downloadJSON()">Download JSON</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let projectsData = null;

        // Load data on page load
        async function loadData() {
            try {
                const response = await fetch('../data/projects.json');
                projectsData = await response.json();
                renderProfile();
                renderAboutPage();
                renderProjects();
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Error loading data', 'error');
            }
        }

        // Render profile form
        function renderProfile() {
            const container = document.getElementById('profile-form');
            const profile = projectsData.profile;

            container.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" data-field="profile.name" value="${escapeHtml(profile.name || '')}">
                    </div>
                    <div class="form-group">
                        <label>Initials</label>
                        <input type="text" data-field="profile.initials" value="${escapeHtml(profile.initials || '')}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" data-field="profile.title" value="${escapeHtml(profile.title || '')}">
                    </div>
                    <div class="form-group">
                        <label>Company</label>
                        <input type="text" data-field="profile.company" value="${escapeHtml(profile.company || '')}">
                    </div>
                </div>
                <div class="form-group">
                    <label>Profile Image Path</label>
                    <input type="text" data-field="profile.profileImage" value="${escapeHtml(profile.profileImage || '')}">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" data-field="profile.email" value="${escapeHtml(profile.email || '')}">
                </div>
                <div class="form-group">
                    <label>LinkedIn URL</label>
                    <input type="url" data-field="profile.social.linkedin" value="${escapeHtml(profile.social?.linkedin || '')}">
                </div>
                <div class="form-group">
                    <label>Resume URL</label>
                    <input type="url" data-field="profile.resume" value="${escapeHtml(profile.resume || '')}" placeholder="Link to your resume PDF or page">
                </div>
                <div class="form-group">
                    <label>Substack URL</label>
                    <input type="url" data-field="profile.social.substack" value="${escapeHtml(profile.social?.substack || '')}" placeholder="https://username.substack.com">
                </div>
            `;
        }

        // Render About Page form
        function renderAboutPage() {
            const container = document.getElementById('about-page-container');
            const aboutPage = projectsData.aboutPage || {};
            const hero = aboutPage.hero || {};
            const travelStories = aboutPage.travelStories || {};
            const values = aboutPage.values || [];
            const testimonials = aboutPage.testimonials || [];

            container.innerHTML = `
                <!-- Hero Section -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>Hero Section (Still Finding Myself)</h2>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" data-field="aboutPage.hero.title" value="${escapeHtml(hero.title || '')}">
                        </div>
                        <div class="form-group">
                            <label>Subtitle</label>
                            <textarea data-field="aboutPage.hero.subtitle">${escapeHtml(hero.subtitle || '')}</textarea>
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">Fan Spread Images (5 images, center image is at position 3)</div>
                            ${(hero.images || []).map((img, i) => `
                                <div class="form-group">
                                    <label>Image ${i + 1} ${i === 2 ? '(Center)' : ''}</label>
                                    <input type="text" data-field="aboutPage.hero.images.${i}" value="${escapeHtml(img || '')}" placeholder="assets/image.jpg">
                                </div>
                            `).join('')}
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">Social Links (buttons under intro)</div>
                            <div class="form-group">
                                <label>LinkedIn URL</label>
                                <input type="text" data-field="aboutPage.hero.links.linkedin" value="${escapeHtml(hero.links?.linkedin || '')}" placeholder="https://linkedin.com/in/username">
                            </div>
                            <div class="form-group">
                                <label>Substack URL</label>
                                <input type="text" data-field="aboutPage.hero.links.substack" value="${escapeHtml(hero.links?.substack || '')}" placeholder="https://username.substack.com">
                            </div>
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" data-field="aboutPage.hero.links.email" value="${escapeHtml(hero.links?.email || '')}" placeholder="email@example.com">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Values Section (My super powers) -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>Values Section (My super powers)</h2>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="subsection">
                            <div class="subsection-title">Values (4 items)</div>
                            <div id="values-items">
                                ${(values || []).map((value, i) => `
                                    <div class="solution-item" style="background: white; padding: 16px; border-radius: 8px; margin-bottom: 12px; border: 1px solid var(--color-border);">
                                        <div class="form-group">
                                            <label>Value ${i + 1} Title</label>
                                            <input type="text" data-field="aboutPage.values.${i}.title" value="${escapeHtml(value.title || '')}">
                                        </div>
                                        <div class="form-group">
                                            <label>Value ${i + 1} Description</label>
                                            <textarea data-field="aboutPage.values.${i}.description">${escapeHtml(value.description || '')}</textarea>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Travel Stories Section -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>Travel Stories Section</h2>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>Description</label>
                            <textarea data-field="aboutPage.travelStories.description">${escapeHtml(travelStories.description || '')}</textarea>
                        </div>
                    </div>
                </div>

                <!-- Testimonials Section -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>Testimonials (What people say about me)</h2>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div id="testimonials-items">
                            ${(aboutPage.testimonials || []).map((t, i) => `
                                <div class="testimonial-item" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Name</label>
                                            <input type="text" data-field="aboutPage.testimonials.${i}.name" value="${escapeHtml(t.name || '')}" placeholder="John Doe">
                                        </div>
                                        <div class="form-group">
                                            <label>Company/Title</label>
                                            <input type="text" data-field="aboutPage.testimonials.${i}.company" value="${escapeHtml(t.company || '')}" placeholder="Product Manager @ Company">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Recommendation</label>
                                        <textarea data-field="aboutPage.testimonials.${i}.recommendation" placeholder="What they said about you...">${escapeHtml(t.recommendation || '')}</textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Photo URL (optional)</label>
                                        <input type="text" data-field="aboutPage.testimonials.${i}.image" value="${escapeHtml(t.image || '')}" placeholder="assets/person.jpg">
                                    </div>
                                    <button class="btn-remove" style="width: 100%; padding: 8px; background: none; border: 1px solid var(--color-danger); color: var(--color-danger); border-radius: 6px; cursor: pointer;" onclick="removeTestimonial(${i})">Remove Testimonial</button>
                                </div>
                            `).join('')}
                        </div>
                        <button class="btn-add" onclick="addTestimonial()">+ Add Testimonial</button>
                    </div>
                </div>
            `;
        }

        // Render projects
        function renderProjects() {
            const container = document.getElementById('projects-container');
            
            container.innerHTML = projectsData.projects.map((project, index) => `
                <div class="section" data-project-index="${index}">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>
                            ${escapeHtml(project.title)}
                            <span class="badge">${escapeHtml(project.company)}</span>
                        </h2>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <!-- Basic Info -->
                        <div class="subsection">
                            <div class="subsection-title">Basic Information</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Project Title</label>
                                    <input type="text" data-field="projects.${index}.title" value="${escapeHtml(project.title)}">
                                </div>
                                <div class="form-group">
                                    <label>Company</label>
                                    <input type="text" data-field="projects.${index}.company" value="${escapeHtml(project.company)}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Year</label>
                                    <input type="text" data-field="projects.${index}.year" value="${escapeHtml(project.year || '')}">
                                </div>
                                <div class="form-group">
                                    <label>Sector</label>
                                    <input type="text" data-field="projects.${index}.sector" value="${escapeHtml(project.sector || '')}">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Short Description (for project card)</label>
                                <textarea data-field="projects.${index}.description">${escapeHtml(project.description || '')}</textarea>
                            </div>
                            <div class="form-group">
                                <label>External URL (opens in new tab instead of project page)</label>
                                <input type="text" data-field="projects.${index}.externalUrl" value="${escapeHtml(project.externalUrl || '')}" placeholder="https://example.com">
                                <small style="color: var(--color-text-secondary); font-size: 0.75rem;">Leave empty to use the default project page</small>
                            </div>
                            <div class="form-group">
                                <label>Release Notes URL (link to published project)</label>
                                <input type="text" data-field="projects.${index}.releaseNotes" value="${escapeHtml(project.releaseNotes || '')}" placeholder="https://example.com/release-notes">
                                <small style="color: var(--color-text-secondary); font-size: 0.75rem;">Shows as "Release Notes ‚Üó" link on project card</small>
                            </div>
                        </div>

                        <!-- Project Details -->
                        <div class="subsection">
                            <div class="subsection-title">Project Details</div>
                            <div class="form-group">
                                <label>Tagline</label>
                                <input type="text" data-field="projects.${index}.details.tagline" value="${escapeHtml(project.details?.tagline || '')}">
                            </div>
                            
                            <!-- Editable Sections -->
                            <div class="editable-section" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                <div class="form-row">
                                    <div class="form-group" style="flex: 0 0 200px;">
                                        <label>Section 1 Header</label>
                                        <input type="text" data-field="projects.${index}.details.overviewHeader" value="${escapeHtml(project.details?.overviewHeader || 'Overview')}" placeholder="Overview">
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label>Section 1 Content</label>
                                        <textarea data-field="projects.${index}.details.overview">${escapeHtml(project.details?.overview || '')}</textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="editable-section" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                <div class="form-row">
                                    <div class="form-group" style="flex: 0 0 200px;">
                                        <label>Section 2 Header</label>
                                        <input type="text" data-field="projects.${index}.details.challengeHeader" value="${escapeHtml(project.details?.challengeHeader || 'Challenge')}" placeholder="Challenge">
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label>Section 2 Content</label>
                                        <textarea data-field="projects.${index}.details.challenge">${escapeHtml(project.details?.challenge || '')}</textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="editable-section" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                <div class="form-row">
                                    <div class="form-group" style="flex: 0 0 200px;">
                                        <label>Section 3 Header</label>
                                        <input type="text" data-field="projects.${index}.details.problemHeader" value="${escapeHtml(project.details?.problemHeader || 'Problem')}" placeholder="Problem">
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label>Section 3 Content</label>
                                        <textarea data-field="projects.${index}.details.problem">${escapeHtml(project.details?.problem || '')}</textarea>
                                    </div>
                                </div>
                                <div class="form-group" style="margin-top: 12px;">
                                    <label>Section 3 Image (optional)</label>
                                    <input type="text" data-field="projects.${index}.details.problemImage" value="${escapeHtml(project.details?.problemImage || '')}" placeholder="assets/image.png">
                                </div>
                            </div>
                            
                            <div class="editable-section" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                <div class="form-row">
                                    <div class="form-group" style="flex: 0 0 200px;">
                                        <label>Section 4 Header</label>
                                        <input type="text" data-field="projects.${index}.details.goalsHeader" value="${escapeHtml(project.details?.goalsHeader || 'Goals')}" placeholder="Goals">
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label>Section 4 Content</label>
                                        <textarea data-field="projects.${index}.details.goals">${escapeHtml(project.details?.goals || '')}</textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="editable-section" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                <div class="form-row">
                                    <div class="form-group" style="flex: 0 0 200px;">
                                        <label>Section 5 Header</label>
                                        <input type="text" data-field="projects.${index}.details.successMetricsHeader" value="${escapeHtml(project.details?.successMetricsHeader || 'Success Metrics')}" placeholder="Success Metrics">
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label>Section 5 Content</label>
                                        <textarea data-field="projects.${index}.details.successMetrics">${escapeHtml(project.details?.successMetrics || '')}</textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="editable-section" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                <div class="form-row">
                                    <div class="form-group" style="flex: 0 0 200px;">
                                        <label>Section 6 Header</label>
                                        <input type="text" data-field="projects.${index}.details.solutionHeader" value="${escapeHtml(project.details?.solutionHeader || 'Final Designs')}" placeholder="Final Designs">
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label>Section 6 Content (optional intro text)</label>
                                        <textarea data-field="projects.${index}.details.solution">${escapeHtml(project.details?.solution || '')}</textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Solution Items with Videos -->
                            <div class="subsection" style="margin-top: 16px;">
                                <div class="subsection-title">Solution Items (with optional videos)</div>
                                <div id="solution-items-${index}">
                                    ${(project.details?.solutionItems || []).map((item, itemIndex) => `
                                        <div class="solution-item" style="background: white; padding: 16px; border-radius: 8px; margin-bottom: 12px; border: 1px solid var(--color-border);">
                                            <div class="form-group">
                                                <label>Item ${itemIndex + 1} Title</label>
                                                <input type="text" data-field="projects.${index}.details.solutionItems.${itemIndex}.title" value="${escapeHtml(item.title || '')}">
                                            </div>
                                            <div class="form-group">
                                                <label>Item ${itemIndex + 1} Description</label>
                                                <textarea data-field="projects.${index}.details.solutionItems.${itemIndex}.description">${escapeHtml(item.description || '')}</textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Item ${itemIndex + 1} Video Path (optional)</label>
                                                <input type="text" data-field="projects.${index}.details.solutionItems.${itemIndex}.video" value="${escapeHtml(item.video || '')}" placeholder="assets/video.mp4">
                                            </div>
                                            <button class="btn-remove" style="width: 100%; padding: 8px; margin-top: 8px;" onclick="removeSolutionItem(${index}, ${itemIndex})">Remove Item</button>
                                        </div>
                                    `).join('')}
                                </div>
                                <button class="btn-add" onclick="addSolutionItem(${index})">+ Add Solution Item</button>
                            </div>
                        </div>

                        <!-- Hero Media -->
                        <div class="subsection">
                            <div class="subsection-title">Hero Media</div>
                            <div class="form-group">
                                <label>Hero Video Path (takes priority over image)</label>
                                <input type="text" data-field="projects.${index}.heroVideo" value="${escapeHtml(project.heroVideo || '')}">
                            </div>
                            <div class="form-group">
                                <label>Hero Image Path (used if no video)</label>
                                <input type="text" data-field="projects.${index}.heroImage" value="${escapeHtml(project.heroImage || '')}">
                            </div>
                        </div>

                        <!-- Homepage Cover -->
                        <div class="subsection">
                            <div class="subsection-title">Homepage Cover</div>
                            <div class="form-group">
                                <label>Cover Video Path (single video for homepage)</label>
                                <input type="text" data-field="projects.${index}.coverVideo" value="${escapeHtml(project.coverVideo || '')}">
                            </div>
                            <div class="form-group">
                                <label>Cover Image Path (used if no video)</label>
                                <input type="text" data-field="projects.${index}.coverImage" value="${escapeHtml(project.coverImage || '')}">
                            </div>
                            <div class="form-group">
                                <label>Cover Videos (two-column layout) - Video 1</label>
                                <input type="text" data-field="projects.${index}.coverVideos.0" value="${escapeHtml((project.coverVideos && project.coverVideos[0]) || '')}">
                            </div>
                            <div class="form-group">
                                <label>Cover Videos (two-column layout) - Video 2</label>
                                <input type="text" data-field="projects.${index}.coverVideos.1" value="${escapeHtml((project.coverVideos && project.coverVideos[1]) || '')}">
                            </div>
                        </div>

                        <!-- Custom Sections (Videos/Images) -->
                        <div class="subsection">
                            <div class="subsection-title">Custom Sections (Videos & Images)</div>
                            <div id="custom-sections-${index}">
                                ${(project.details?.customSections || []).map((section, secIndex) => `
                                    <div class="custom-section-item" style="background: white; padding: 16px; border-radius: 8px; margin-bottom: 12px; border: 1px solid var(--color-border);">
                                        <div class="form-group">
                                            <label>Section Title</label>
                                            <input type="text" data-field="projects.${index}.details.customSections.${secIndex}.title" value="${escapeHtml(section.title || '')}">
                                        </div>
                                        <div class="form-group">
                                            <label>Section Content</label>
                                            <textarea data-field="projects.${index}.details.customSections.${secIndex}.content">${escapeHtml(section.content || '')}</textarea>
                                        </div>
                                        <div class="form-group">
                                            <label>Video Path (leave empty if using image)</label>
                                            <input type="text" data-field="projects.${index}.details.customSections.${secIndex}.video" value="${escapeHtml(section.video || '')}">
                                        </div>
                                        <div class="form-group">
                                            <label>Image Path (leave empty if using video)</label>
                                            <input type="text" data-field="projects.${index}.details.customSections.${secIndex}.image" value="${escapeHtml(section.image || '')}">
                                        </div>
                                        <button class="btn-remove" style="width: 100%; padding: 8px; margin-top: 8px;" onclick="removeCustomSection(${index}, ${secIndex})">Remove Section</button>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="btn-add" onclick="addCustomSection(${index})">+ Add Custom Section</button>
                        </div>

                        <!-- Team Credits -->
                        <div class="subsection">
                            <div class="subsection-title">Team Credits</div>
                            <div class="form-group">
                                <label>Product (comma separated)</label>
                                <input type="text" data-field="projects.${index}.details.team.product" value="${escapeHtml((project.details?.team?.product || []).join(', '))}">
                            </div>
                            <div class="form-group">
                                <label>Design (comma separated)</label>
                                <input type="text" data-field="projects.${index}.details.team.design" value="${escapeHtml((project.details?.team?.design || []).join(', '))}">
                            </div>
                            <div class="form-group">
                                <label>Research (comma separated)</label>
                                <input type="text" data-field="projects.${index}.details.team.research" value="${escapeHtml((project.details?.team?.research || []).join(', '))}">
                            </div>
                            <div class="form-group">
                                <label>Engineering (comma separated)</label>
                                <input type="text" data-field="projects.${index}.details.team.engineering" value="${escapeHtml((project.details?.team?.engineering || []).join(', '))}">
                            </div>
                            <div class="form-group">
                                <label>Content (comma separated)</label>
                                <input type="text" data-field="projects.${index}.details.team.content" value="${escapeHtml((project.details?.team?.content || []).join(', '))}">
                            </div>
                        </div>

                        <!-- Preview Link -->
                        <div style="margin-top: 16px; text-align: right;">
                            <a href="../project.html?id=${project.id}" class="preview-link" target="_blank">Preview this project ‚Üó</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toggle section collapse
        function toggleSection(header) {
            header.parentElement.classList.toggle('collapsed');
        }

        // Tab switching
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        // Collect all form data and update projectsData
        function collectFormData() {
            document.querySelectorAll('[data-field]').forEach(input => {
                const path = input.dataset.field.split('.');
                let value = input.value;
                
                // Handle team fields - convert comma-separated to array
                if (path.includes('team') && ['product', 'design', 'research', 'engineering', 'content'].includes(path[path.length - 1])) {
                    value = value.split(',').map(s => s.trim()).filter(s => s.length > 0);
                }
                
                let obj = projectsData;
                for (let i = 0; i < path.length - 1; i++) {
                    const key = isNaN(path[i]) ? path[i] : parseInt(path[i]);
                    if (!obj[key]) {
                        // Check if next key is numeric - if so, create array
                        const nextKey = path[i + 1];
                        obj[key] = !isNaN(nextKey) ? [] : {};
                    }
                    obj = obj[key];
                }
                
                const lastKey = isNaN(path[path.length - 1]) ? path[path.length - 1] : parseInt(path[path.length - 1]);
                obj[lastKey] = value;
            });
            
            // Clean up empty coverVideos arrays
            if (projectsData.projects) {
                projectsData.projects.forEach(project => {
                    if (project.coverVideos) {
                        project.coverVideos = project.coverVideos.filter(v => v && v.trim() !== '');
                        if (project.coverVideos.length === 0) {
                            delete project.coverVideos;
                        }
                    }
                });
            }
        }

        // Save changes - show modal with JSON
        function saveChanges() {
            collectFormData();
            const jsonOutput = JSON.stringify(projectsData, null, 2);
            document.getElementById('json-output').value = jsonOutput;
            document.getElementById('json-modal').classList.add('show');
        }

        // Close modal
        function closeModal() {
            document.getElementById('json-modal').classList.remove('show');
        }

        // Copy to clipboard
        async function copyToClipboard() {
            const textarea = document.getElementById('json-output');
            try {
                await navigator.clipboard.writeText(textarea.value);
                showToast('Copied to clipboard!', 'success');
            } catch (err) {
                textarea.select();
                document.execCommand('copy');
                showToast('Copied to clipboard!', 'success');
            }
        }

        // Download JSON file
        function downloadJSON() {
            const json = document.getElementById('json-output').value;
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'projects.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Downloaded projects.json', 'success');
        }

        // Add image to project
        function addImage(projectIndex) {
            if (!projectsData.projects[projectIndex].details.images) {
                projectsData.projects[projectIndex].details.images = [];
            }
            projectsData.projects[projectIndex].details.images.push({ src: '', caption: '' });
            renderProjects();
        }

        // Remove image from project
        function removeImage(projectIndex, imageIndex) {
            projectsData.projects[projectIndex].details.images.splice(imageIndex, 1);
            renderProjects();
        }

        // Add custom section to project
        function addCustomSection(projectIndex) {
            if (!projectsData.projects[projectIndex].details.customSections) {
                projectsData.projects[projectIndex].details.customSections = [];
            }
            projectsData.projects[projectIndex].details.customSections.push({ 
                title: '', 
                content: '', 
                video: '',
                image: ''
            });
            renderProjects();
        }

        // Remove custom section from project
        function removeCustomSection(projectIndex, sectionIndex) {
            projectsData.projects[projectIndex].details.customSections.splice(sectionIndex, 1);
            renderProjects();
        }

        // Add solution item to project
        function addSolutionItem(projectIndex) {
            if (!projectsData.projects[projectIndex].details.solutionItems) {
                projectsData.projects[projectIndex].details.solutionItems = [];
            }
            projectsData.projects[projectIndex].details.solutionItems.push({ 
                title: '', 
                description: '', 
                video: ''
            });
            renderProjects();
        }

        // Remove solution item from project
        function removeSolutionItem(projectIndex, itemIndex) {
            projectsData.projects[projectIndex].details.solutionItems.splice(itemIndex, 1);
            renderProjects();
        }

        // Add testimonial
        function addTestimonial() {
            if (!projectsData.aboutPage.testimonials) {
                projectsData.aboutPage.testimonials = [];
            }
            projectsData.aboutPage.testimonials.push({
                name: '',
                company: '',
                recommendation: '',
                image: ''
            });
            renderAboutPage();
        }

        // Remove testimonial
        function removeTestimonial(index) {
            projectsData.aboutPage.testimonials.splice(index, 1);
            renderAboutPage();
        }

        // Show toast notification
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (type ? ' ' + type : '');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        loadData();
    </script>
</body>
</html>

